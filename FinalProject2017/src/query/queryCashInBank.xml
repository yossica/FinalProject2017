<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL MAP 2.0//EN"
"http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="cashInBank">

	<select id="getAllWithFilter" parameterClass="java.util.Map">
		select
			transaction_cash_in_bank_id as transactionCashInBankId,
			cash_flow_category_id as cashFlowCategoryId,
			cash_flow_category_name as cashFlowCategoryName,
			amount,
			balance,
			description,
			to_char(transaction_date, 'MM/dd/yyyy') as transactionDate,
			is_debit as isDebit,
			created_by as createdBy,
			to_char(created_date, 'MM/dd/yyyy') as createdDate
		from transaction_cash_in_bank
		where
			transaction_date between to_date(#startDate#,'MM/dd/yyyy') and to_date(#endDate#,'MM/dd/yyyy')
			<dynamic prepend="AND">
				<isNotNull property="category">
					<isNotEmpty property="category">
						cash_flow_category_id = #category#
					</isNotEmpty>
				</isNotNull>
			</dynamic>
		order by created_date
	</select>
	
	<select id="getCurrentBalance" resultClass="java.lang.Double">
		select balance
		from transaction_cash_in_bank b,
		(select max(created_date) as max_date from transaction_cash_in_bank) c
		where b.created_date = c.max_date
	</select>

	<insert id="insert">
		insert into transaction_cash_in_bank (transaction_cash_in_bank_id, cash_flow_category_id,
			amount, balance, description, transaction_date, 
			is_debit, created_by, created_date)
		values (#transactionCashInBankId#,#cashFlowCategoryId#,
			#amount#,#balance#,#description#,to_date(#transactionDate#,'MM/dd/yyyy'),
			#isDebit#,#createdBy#, sysdate)
	</insert>
	
</sqlMap> 
